<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lernplattform Begriffsdefinitionen - Ril 408.2101A01</title>
    
    <link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22Lernplattform%20Ril%20408%22%2C%22short_name%22%3A%22Ril%20408%20Lernen%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23F2F2F2%22%2C%22theme_color%22%3A%22%23273A73%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22https%3A%2F%2Fwww.eurobahn.de%2Ffileadmin%2Fbilder%2Flogos%2Flogo-eurobahn.svg%22%2C%22sizes%22%3A%22any%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%7D%5D%7D">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ril 408 Lernen">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.1.0/diff.min.js"></script>
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #F2F2F2; /* Eurobahn Off-White */
            color: #2B3959; /* Eurobahn Medium Blue */
        }
        /* Eurobahn CI Farben */
        :root {
            --eb-dark-blue: #273A73;
            --eb-medium-blue: #2B3959;
            --eb-teal: #3FA6A6;
            --eb-light-teal: #C4F2EE;
            --eb-off-white: #F2F2F2;
        }

        /* Ladebildschirm */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--eb-off-white);
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease-out;
            text-align: center;
        }
        .loader.fade-out {
            opacity: 0;
        }
        .loader.hidden {
            display: none;
            visibility: hidden;
        }
        .loader .header-content {
            animation: pulse 1.5s infinite ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        /* Hauptinhalt, der zuerst versteckt ist */
        .main-content {
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }
        .main-content.visible {
            opacity: 1;
        }
        
        /* Karten-Design */
        .card-container {
            perspective: 1000px;
        }
        .card {
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            border: 1px solid #e5e7eb;
        }
        .card-face-front {
            background-color: white;
            justify-content: center;
            align-items: center;
        }
        .card-face-back {
            background-color: white;
            transform: rotateY(180deg);
            justify-content: flex-start;
        }
        .card-header {
            padding: 0.75rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 700;
            color: white;
            border-radius: 0.75rem 0.75rem 0 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        .card-content {
            padding: 1.5rem;
            overflow-y: auto;
            flex-grow: 1;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            word-break: break-word;
        }
        .correct-answer {
            background-color: #C4F2EE !important;
            color: var(--eb-dark-blue) !important;
            border: 2px solid var(--eb-teal) !important;
        }
        .wrong-answer {
            background-color: #fee2e2 !important;
            color: #991b1b !important;
            border: 2px solid #fca5a5 !important;
        }
        #feedback ins {
            background-color: #C4F2EE;
            text-decoration: none;
            padding: 0 2px;
            border-radius: 3px;
        }
        #feedback del {
            background-color: #fecaca;
            text-decoration: line-through;
            padding: 0 2px;
            border-radius: 3px;
        }
        
        /* Text overflow handling for card content */
        .card-content h2 {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            word-break: break-word;
        }
        
        /* Ensure all text elements in cards handle overflow properly */
        .card-content p,
        .card-content div,
        .card-content span {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        
        /* Search functionality styles */
        .search-highlight {
            background-color: #fef08a;
            padding: 1px 2px;
            border-radius: 2px;
        }
        
        /* Definition quiz text overflow handling */
        .definition-quiz h2 {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            word-break: break-word;
        }
        
        .definition-quiz textarea {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        
        .definition-quiz #feedback {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            word-break: break-word;
        }
        
        .definition-quiz p {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            word-break: break-word;
        }
        
        .definition-quiz .answer-option {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            word-break: break-word;
        }
        
        /* Begriff selection list text overflow handling */
        .term-selection-item {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            word-break: break-word;
        }
        
        .term-selection-item span {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            word-break: break-word;
        }
    </style>
</head>
<body class="antialiased">
    <div id="loader" class="loader">
        <header class="p-4 sm:p-8 flex flex-col sm:flex-row justify-center items-center gap-4">
            <img src="https://upload.wikimedia.org/wikipedia/commons/2/23/BSicon_BAHN.svg" alt="Eisenbahn" class="h-12 md:h-16">
            <div class="text-center sm:text-left">
                <h1 class="text-3xl md:text-4xl font-bold text-[--eb-dark-blue] tracking-wide">Lernplattform</h1>
                <p class="text-lg text-gray-500">Begriffsdefinitionen Ril 408.2101A01</p>
            </div>
        </header>
    </div>

    <div class="container mx-auto p-4 md:p-8 min-h-screen flex flex-col main-content">

        <div id="progress-dashboard" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-6 w-full max-w-5xl mx-auto">
            <h2 class="text-xl font-semibold mb-4 text-[--eb-dark-blue]">Lernfortschritt</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div class="bg-gray-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-gray-700" id="total-terms">69</div>
                    <div class="text-sm text-gray-500">Begriffe gesamt</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-green-600" id="known-count">0</div>
                    <div class="text-sm text-green-600">Gewusst</div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-red-600" id="unknown-count">0</div>
                    <div class="text-sm text-red-600">Nicht gewusst</div>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-blue-600" id="neutral-count">69</div>
                    <div class="text-sm text-blue-600">Noch nicht bewertet</div>
                </div>
            </div>
            
            <div class="flex flex-wrap gap-2 mb-4">
                <button id="filter-all" class="px-4 py-2 bg-[--eb-dark-blue] text-white rounded-lg hover:bg-[--eb-medium-blue] transition">Alle anzeigen</button>
                <button id="filter-unknown" class="px-4 py-2 bg-red-100 text-red-700 hover:bg-red-200 rounded-lg transition">Nur nicht gewusste</button>
                <button id="filter-known" class="px-4 py-2 bg-green-100 text-green-700 hover:bg-green-200 rounded-lg transition">Nur gewusste</button>
                <button id="filter-neutral" class="px-4 py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-lg transition">Nur unbewertete</button>
                <button id="reset-progress" class="px-4 py-2 bg-orange-100 text-orange-700 hover:bg-orange-200 rounded-lg transition ml-auto">Fortschritt zurücksetzen</button>
            </div>
            
            <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="progress-bar" class="bg-[--eb-teal] h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p class="text-sm text-gray-600 text-center" id="progress-text">0% bewertet</p>
        </div>

        <div id="settings-view" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8 w-full max-w-5xl mx-auto">
            <div id="settings-content">
                <h2 class="text-2xl font-semibold mb-4 text-[--eb-dark-blue]">1. Einstellungen</h2>
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-3 text-gray-600">Modus auswählen:</h3>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <label class="flex-1 bg-gray-100 p-4 rounded-lg cursor-pointer hover:bg-gray-200 transition duration-200 border has-[:checked]:border-[--eb-teal] has-[:checked]:bg-[--eb-light-teal]">
                            <input type="radio" name="mode" value="learn" class="mr-3 accent-[--eb-teal]" checked>
                            <span class="font-semibold">Lernmodus (Karteikarten)</span>
                        </label>
                        <label class="flex-1 bg-gray-100 p-4 rounded-lg cursor-pointer hover:bg-gray-200 transition duration-200 border has-[:checked]:border-[--eb-teal] has-[:checked]:bg-[--eb-light-teal]">
                            <input type="radio" name="mode" value="test-term" class="mr-3 accent-[--eb-teal]">
                            <span class="font-semibold">Test: Begriff &rarr; Definition</span>
                        </label>
                        <label class="flex-1 bg-gray-100 p-4 rounded-lg cursor-pointer hover:bg-gray-200 transition duration-200 border has-[:checked]:border-[--eb-teal] has-[:checked]:bg-[--eb-light-teal]">
                            <input type="radio" name="mode" value="test-def" class="mr-3 accent-[--eb-teal]">
                            <span class="font-semibold">Test: Definition &rarr; Begriff</span>
                        </label>
                    </div>
                </div>

                <div>
                    <h2 class="text-2xl font-semibold mb-4 text-[--eb-dark-blue]">2. Begriffe auswählen</h2>
                    
                    <div class="mb-4">
                        <div class="relative">
                            <input type="text" id="search-input" placeholder="Begriffe durchsuchen..." 
                                   class="w-full p-3 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[--eb-teal] focus:border-[--eb-teal] text-gray-700">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <p id="search-results-count" class="text-sm text-gray-500 mt-2 hidden"></p>
                        <p id="selection-count" class="text-sm text-gray-600 mt-1 font-medium"></p>
                    </div>
                    
                    <div class="flex flex-wrap gap-4 mb-4">
                        <button id="select-all" class="bg-[--eb-medium-blue] hover:bg-[--eb-dark-blue] text-white font-bold py-2 px-4 rounded-lg transition duration-200">Alle auswählen</button>
                        <button id="deselect-all" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-200">Alle abwählen</button>
                        <button id="select-visible" class="bg-[--eb-teal] hover:bg-[#358f8f] text-white font-bold py-2 px-4 rounded-lg transition duration-200 hidden">Sichtbare auswählen</button>
                        <button id="clear-search" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 hidden">Suche löschen</button>
                    </div>
                    <div id="term-selection" class="max-h-64 overflow-y-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 bg-gray-50 p-4 rounded-lg border border-gray-200">
                    </div>
                </div>

                <div class="mt-8 text-center">
                    <button id="start-btn" class="bg-[--eb-teal] hover:bg-[#358f8f] text-white font-bold text-xl py-3 px-10 rounded-lg transition duration-200 shadow-md">Sitzung starten</button>
                </div>
            </div>
            <div id="no-selection-warning" class="hidden text-center text-red-700 font-semibold bg-red-100 p-4 rounded-lg border border-red-300 mt-4">
                Bitte wählen Sie mindestens einen Begriff aus, um zu starten.
            </div>
        </div>

        <main id="main-view" class="hidden flex-grow flex flex-col items-center justify-center w-full"></main>

    </div>

    <script>
        const definitions = [
            { term: "Ablaufen, Abdrücken", definition: "Ablaufen ist das Bewegen von Fahrzeugen durch Schwerkraft im Allgemeinen von einem Ablaufberg herab, über den die Fahrzeuge abgedrückt werden." },
            { term: "Abstellen", definition: "Züge und Triebfahrzeuge sind abgestellt, wenn sie nicht mit einem Triebfahrzeugführer besetzt sind oder nicht gesteuert werden. Wagen sind abgestellt, sofern sie nicht in Züge eingestellt sind oder nicht rangiert werden." },
            { term: "Abstoßen", definition: "Abstoßen ist das Bewegen geschobener, nicht mit einem arbeitenden Triebfahrzeug gekuppelter Fahrzeuge durch Beschleunigen, so dass die Fahrzeuge allein weiterfahren, nachdem das Triebfahrzeug angehalten hat." },
            { term: "Abzweigstellen", definition: "Abzweigstellen sind Blockstellen der freien Strecke, wo Züge von einer Strecke auf eine andere Strecke übergehen können. Eine Abzweigstelle wird durch ihre Blocksignale bzw. Signale Ne 14 begrenzt." },
            { term: "Anschlussbahnhöfe", definition: "Anschlussbahnhöfe haben besondere Aufgaben bei der Meldung der Züge." },
            { term: "Anschlussstellen, Ausweichanschlussstellen", definition: "Anschlussstellen sind Bahnanlagen der freien Strecke, wo Züge ein angeschlossenes Gleis als Rangierfahrt befahren können. Es sind zu unterscheiden:\na) Anschlussstellen, bei denen die Blockstrecke nicht für einen anderen Zug freigegeben wird,\nb) Anschlussstellen, bei denen die Blockstrecke für einen anderen Zug freigegeben wird (Ausweichanschlussstellen)." },
            { term: "Anzeigegeführt", definition: "Ein Zug ist anzeigegeführt, wenn eine Zugbeeinflussung (LZB, ETCS) wirkt, die den Zug selbsttätig zum Halten bringen kann und außerdem führt, d. h. Führungsgrößen im Führerraum anzeigt, die für den Fahrtverlauf zulässigen Geschwindigkeiten kontinuierlich überwacht und ggf. die Geschwindigkeit selbsttätig regelt. Anzeigegeführte Züge können LZB-geführt oder ETCS-geführt sein." },
            { term: "Arbeitendes Triebfahrzeug", definition: "Ein Triebfahrzeug ist arbeitend, wenn es Antriebskraft erzeugt." },
            { term: "aS-Zug", definition: "aS-Züge sind Züge mit häufig vorkommenden außergewöhnlichen Sendungen, die im Fahrplan für Zugmeldestellen und Streckenfahrplan durch den Zusatz „aS“ hinter der Zugnummer gekennzeichnet sind." },
            { term: "Aufdrücken", definition: "Aufdrücken ist das Bewegen von Fahrzeugen zum Entkuppeln oder von kuppelreif stehenden Fahrzeugen zum Kuppeln." },
            { term: "Aufgehobene Signalabhängigkeit", definition: "Signalabhängigkeit ist in folgenden Fällen aufgehoben:\nEin Hauptsignal kann auf Fahrt gestellt werden und eine Fachkraft hat im Arbeits- und Störungsbuch die Abhängigkeit für aufgehoben erklärt.\nEin Hauptsignal kann auf Fahrt gestellt werden und die Zungen- oder Herzstückverschlüsse von Weichen wirken nicht ordnungsgemäß.\nBei einer virtuellen Blockstelle entspricht deren Fahrtmelder der Fahrtstellung des Hauptsignals." },
            { term: "Bahnanlagen", definition: "Es gibt Bahnanlagen der Bahnhöfe, der freien Strecke und sonstige Bahnanlagen." },
            { term: "Bahnbetrieb", definition: "Bahnbetrieb ist das Bewegen von Fahrzeugen. Zum Bahnbetrieb gehören das Fahren von Zügen und das Rangieren." },
            { term: "Bahnhöfe, Bahnhofsteile", definition: "Bahnhöfe sind Bahnanlagen mit mindestens einer Weiche, wo Züge beginnen, enden, halten, kreuzen, überholen oder wenden dürfen. Bahnhöfe können in Bahnhofsteile unterteilt sein. Bahnhofsteile können durch Zwischensignale bzw. Signale Ne 14 gegeneinander abgegrenzt sein." },
            { term: "Balise, Balisengruppe", definition: "Eine Balise ist ein im Gleis angeordnetes Datenübertragungselement. Bei ETCS übertragen Balisen Informationen zur Fahrzeugortung. Um die Fahrtrichtung eindeutig herleiten zu können, können Balisen zu einer Balisengruppe zusammengefasst sein. Bei ETCS-Level 1 übertragen schaltbare Balisen zusätzlich zur Ortung auch ETCS-Fahrterlaubnisse. An Signalen Ne 14 sind Balisen mit der Information „Halt in ETCS-Betriebsart SR“ verlegt. Bei Neigetechnik übertragen Balisen Informationen für die Geschwindigkeitsüberwachung für Neigetechnik." },
            { term: "Bedarfshalt", definition: "Ein Bedarfshalt ist ein Fahrplanhalt, bei dem ein Zug auf der Betriebsstelle halten muss, wenn:\n- der Triebfahrzeugführer ein Haltsignal oder ein blinkendes Signal Ne 5 erhält,\n- der Triebfahrzeugführer Reisende bemerkt, die ein- oder aussteigen wollen,\n- die Fahrgasthaltewunscheinrichtung dem Triebfahrzeugführer einen Haltewunsch anzeigt oder\n- der Triebfahrzeugführer nicht verständigt wurde, dass der Halt ausfallen darf." },
            { term: "Beidrücken", definition: "Beidrücken ist das Bewegen getrennt stehender Fahrzeuge zum Kuppeln." },
            { term: "Betriebliche Abfahrtszeit", definition: "Die betriebliche Abfahrtzeit ist für die Abfahrt des Zuges auf einer Betriebsstelle maßgeblich. In den Fahrplänen dieser Betriebsstellen können daneben auch verkehrliche Abfahrtzeiten veröffentlich sein." },
            { term: "Betriebshalt", definition: "Ein Betriebshalt ist ein Fahrplanhalt, bei dem ein Zug auf der Betriebsstelle halten muss, wenn der Triebfahrzeugführer ein Haltsignal erhält." },
            { term: "Betriebsstellen", definition: "Betriebsstellen sind:\na) Bahnhöfe, Blockstellen, Abzweigstellen, Anschlussstellen, Haltepunkte, Haltestellen, Deckungsstellen oder\nb) Stellen in den Bahnhöfen oder auf der freien Strecke, die der unmittelbaren Regelung und Sicherung der Zugfahrten und des Rangierens dienen." },
            { term: "Blockstellen", definition: "Blockstellen sind Bahnanlagen, die eine Blockstrecke begrenzen. Eine Blockstelle kann zugleich als Bahnhof, Abzweigstelle, Überleitstelle, Anschlussstelle, Haltepunkt, Haltestelle oder Deckungsstelle eingerichtet sein. Es gibt Blockstellen für signalgeführte Züge, für anzeigegeführte Züge und für Züge in ETCS-Betriebsart SR. Blockstellen für signalgeführte Züge sind an Hauptsignalen eingerichtet. Blockstellen für anzeigegeführte Züge sind eingerichtet an Hauptsignalen oder als virtuelle Blockstellen. Blockstellen für Züge in ETCS-Betriebsart SR sind an Signalen Ne 14 eingerichtet." },
            { term: "Blockstrecken", definition: "Blockstrecken sind Gleisabschnitte, in die ein Zug nur einfahren darf, wenn sie frei von Fahrzeugen sind. Es gibt Blockstrecken für signalgeführte und für anzeigegeführte Züge." },
            { term: "Deckungsstellen", definition: "Deckungsstellen sind Bahnanlagen der freien Strecke, die den Bahnbetrieb insbesondere an beweglichen Brücken, Kreuzungen von Bahnen, Gleisverschlingungen oder Baustellen sichern." },
            { term: "Durchgehende Hauptgleise", definition: "Durchgehende Hauptgleise sind die Hauptgleise der freien Strecke und ihre Fortsetzung in den Bahnhöfen." },
            { term: "Einfahrweiche", definition: "Die Einfahrweiche ist die erste Weiche eines Bahnhofs, die bei Einfahrt von der freien Strecke her befahren wird." },
            { term: "ETCS-Fahrterlaubnis", definition: "Die ETCS-Fahrterlaubnis ist die Erlaubnis für einen ETCS-geführten Zug, bis zu einer bestimmten Stelle, dem ETCS-Halt, zu fahren." },
            { term: "ETCS-Halt", definition: "Ein ETCS-Halt ist die Stelle, an der die ETCS-Fahrterlaubnis eines ETCS-geführten Zuges endet. Dem Triebfahrzeugführer wird ein ETCS-Halt durch eine Zielgeschwindigkeit von 0 km/h angekündigt und durch eine Sollgeschwindigkeit von 0 km/h angezeigt. In ETCS-Betriebsart SR wird dem Triebfahrzeugführer ein ETCS-Halt durch ein Signal Ne 14 angezeigt." },
            { term: "ETCS-Zentrale", definition: "Zu einer ETCS-Zentrale gehören:\n- die ETCS-Bedieneinrichtung,\n- ein sicheres Rechnersystem und\n- die Schnittstellen zu den Stellwerken, ETCS-Nachbarzentralen und zum GSM-R." },
            { term: "Fahrdienstleiter", definition: "Fahrdienstleiter regeln die Durchführung der Zugfahrten. Fahrdienstleiter dürfen auch die Tätigkeiten von Weichenwärtern verrichten. Fahrdienstleiter und Weichenwärter sind in den Richtlinien 408.01-06 und 408.48 zusammenfassend in Kurzform auch als „Bediener“ angesprochen. Ein Bahnhof kann in mehrere Fahrdienstleiterbezirke aufgeteilt sein. Selbsttätige Blockstellen des automatischen Streckenblocks sind auf zweigleisigen Strecken dem Fahrdienstleiter der vorgelegenen Zugmeldestelle, auf eingleisigen Strecken einem festgelegten Fahrdienstleiter zugeteilt. Selbsttätige Blockstellen der übrigen Blockbauformen, Blockstellen für anzeigegeführte Züge oder örtlich nicht besetzte Bahnhöfe oder Abzweigstellen gelten als mit dem Fahrdienstleiter besetzt, der die Signalanlagen dieser Stellen bedient." },
            { term: "Fahrplanhalt", definition: "Es gibt folgende Fahrplanhalte: Regelhalt, Bedarfshalt, Betriebshalt und Halt zum Sichern eines Bahnübergangs." },
            { term: "Fahrtstellung eines Hauptsignals, Hauptsignal auf Fahrt stellen", definition: "Fahrtstellung eines Hauptsignals bzw. Formulierungen wie „ein Hauptsignal auf Fahrt stellen“ umfassen jede Signalstellung eines Hauptsignals, die es dem Triebfahrzeugführer eines Zuges erlaubt, an dem Signal vorbeizufahren, z. B. Signal Hp 2, Ks 1, HI 3a, Sv 4. An einer virtuellen Blockstelle entspricht der Fahrtstellung des Hauptsignals der entsprechende Fahrtmelder." },
            { term: "Fahrzeuge", definition: "Fahrzeuge werden unterschieden nach Regelfahrzeugen und Nebenfahrzeugen." },
            { term: "Fahrzeuge mit unzureichender Belegung von 42 Hz und 100 Hz-Gleisstromkreisen", definition: "Regelfahrzeuge oder schwere Nebenfahrzeuge, welche die Gleisfreimeldeanlagen der 42 Hz oder 100 Hz-Gleisstrom-Technik (Bauform WSSB) während der Fahrt nicht zuverlässig erkennen können, werden als \"Fahrzeuge mit unzureichender Belegung von 42 Hz und 100 Hz-Gleisstromkreisen\" bezeichnet." },
            { term: "Fehlleitung, fehlleiten", definition: "Ein Zug wird fehlgeleitet, wenn er in einen Fahrweg eingelassen wird, der nicht seinem Fahrplan oder seinem Auftrag entspricht." },
            { term: "Flankenschutzeinrichtungen", definition: "Flankenschutzeinrichtungen sind signaltechnische Einrichtungen, die Fahrten auf Fahrstraßen gegen Fahrzeugbewegungen schützen. Zu den Flankenschutzeinrichtungen gehören Weichen, Gleissperren, Sperrsignale, Hauptsignale ohne Signal Zs 103, Signale Ra 11 (DS 301) mit Lichtsignal Sh 1, sofern technisch ausgeschlossen ist, dass das Signal Sh 1 erteilt werden kann, solange das Wartezeichen als Flankenschutz für eine Zugfahrt dient, Signale Ra 11 a (DV 301) und alleinstehende Signale Ne 14." },
            { term: "Flankenschutzraum", definition: "Flankenschutzraum ist der Raum zwischen einer Flankenschutzeinrichtung oder einem Signal Ne 14 und dem Grenzzeichen einer Weiche oder Kreuzung im Fahrweg oder Durchrutschweg." },
            { term: "Führungsgrößen", definition: "Sollgeschwindigkeit, Zielgeschwindigkeit und Zielentfernung werden bei anzeigegeführten Zügen als Führungsgrößen bezeichnet und im Führerraum angezeigt." },
            { term: "FS (Full Supervision)", definition: "Betriebsart bei ETCS, bei der ein Zug in Vollüberwachung fährt, und zwar mit einer ETCS-Fahrterlaubnis, die ETCS dem Triebfahrzeugführer mit Führungsgrößen und einem Symbol in der Führerraumanzeige anzeigt." },
            { term: "Gegengleis", definition: "Das Gleis, das auf zweigleisiger, freier Strecke entgegen der gewöhnlichen Fahrtrichtung befahren wird, wird als Gegengleis bezeichnet." },
            { term: "Geschobene Züge", definition: "Geschobene Züge sind Züge, in denen kein arbeitendes Triebfahrzeug an der Spitze läuft oder von der Spitze aus gesteuert wird. Züge, die aus einem Nebenfahrzeug mit Kraftantrieb und einem vorangestellten Nebenfahrzeug ohne Kraftantrieb oder aus einem Triebfahrzeug und einem vorangestellten Schneeräumfahrzeug gebildet sind, sind keine geschobenen Züge, wenn die Fahrzeuge eine bauartkompatible Einheit bilden." },
            { term: "Gewöhnlicher Halteplatz", definition: "Der gewöhnliche Halteplatz ist die Stelle, an der ein Zug bei einem planmäßigen Halt dem Zweck des Haltes entsprechend halten muss. Im Einzelnen gilt Folgendes:\nDer gewöhnliche Halteplatz eines Reisezuges mit Betriebshalt oder eines Güterzuges ist möglichst nahe am Halt gebietenden Signal, vor dem LZB-Halt bzw. vor dem ETCS-Halt.\nDer gewöhnliche Halteplatz eines Reisezuges mit Regelhalt oder Bedarfshalt ist am Bahnsteig, hierbei müssen sich in der Regel alle für Reisende zum Ein- und Aussteigen vorgesehenen Türen am Bahnsteig befinden.\nDie Regeln zum gewöhnlichen Halteplatz gelten nicht für Halte zum Sichern eines Bahnüberganges." },
            { term: "Gleiswechselbetrieb", definition: "Gleiswechselbetrieb ist eingerichtet, wo das Gegengleis mit Hauptsignal und Signal Zs 6 befahren werden kann. Gleiswechselbetrieb kann ständig oder vorübergehend eingerichtet sein. Vorübergehend eingerichteter Gleiswechselbetrieb wird in einer Betra angeordnet." },
            { term: "Grenze zwischen Bahnhof und freier Strecke", definition: "Als Grenze zwischen den Bahnhöfen und der freien Strecke gelten im Allgemeinen die Einfahrsignale bzw. die sie ersetzenden Signale Ne 14 oder Trapeztafeln, sonst die Einfahrweichen. Bei besonderen örtlichen Verhältnissen kann die Grenze anderweitig festgelegt sein. Bahnhofsgleise und andere Anlagen neben den durchgehenden Hauptgleisen, die über die Grenze hinausreichen, gehören zu den Bahnhofsanlagen." },
            { term: "Grenzsignal", definition: "Ein Grenzsignal ist ein Hauptsignal, an dem eine Strecke mit ETCS beginnt oder endet." },
            { term: "Halt zum Sichern eines Bahnüberganges", definition: "Ein Halt zum Sichern eines Bahnüberganges ist ein Fahrplanhalt, bei dem ein Zug vor dem Bahnübergang anhalten muss, weil der Bahnübergang planmäßig durch Zugpersonal oder durch andere Mitarbeiter gesichert werden muss." },
            { term: "Haltepunkte", definition: "Haltepunkte sind Bahnanlagen ohne Weichen, wo Züge planmäßig halten, beginnen oder enden dürfen." },
            { term: "Haltestellen", definition: "Haltestellen sind Abzweigstellen, Überleitstellen oder Anschlussstellen, die mit einem Haltepunkt örtlich verbunden sind." },
            { term: "Hauptgleise", definition: "Hauptgleise sind die von Zügen planmäßig befahrenen Gleise." },
            { term: "IS (Isolation)", definition: "Betriebsart bei ETCS, wenn das ETCS-Fahrzeuggerät mit dem Störschalter ausgeschaltet ist. Es sind keine Eingaben und Anzeigen über die Fahrzeugeinrichtung möglich. Der Zug kann ohne ETCS-Fahrterlaubnis fahren." }, { term: "Kleinwagen", definition: "Kleinwagen sind Nebenfahrzeuge, die Gleisschaltmittel oder Gleisfreimeldeanlagen nicht zuverlässig beeinflussen." },
            { term: "Kleinwagenfahrten", definition: "Kleinwagenfahrten sind Fahrten, die aus Kleinwagen gebildet sind oder in die Kleinwagen eingestellt sind. Sie dürfen nur als Sperrfahrt oder Rangierfahrt verkehren. Kleinwagenfahrten als Sperrfahrten sind nach den Regeln für Zugfahrten unter Beachtung der für Kleinwagenfahrten geltenden Besonderheiten durchzuführen. Kleinwagenfahrten als Rangierfahrten sind nach den Regeln für das Rangieren unter Beachtung der für Kleinwagen geltenden Besonderheiten durchzuführen." },
            { term: "Kontaktstelle", definition: "Kontaktstelle ist:\na) die Zugmeldestelle, die während der Arbeitsunterbrechung der überwachenden Zugmeldestelle bei der Notfallleitstelle für ein der überwachenden Zugmeldestelle zugeordnetes, gesperrtes Gleis Hilfe aufrufen muss,\nb) die Betriebsstelle, die die Meldungen zu Arbeitsende und Arbeitsbeginn bei unterbrochener Arbeitszeit entgegennimmt und der Besonderheiten während der unterbrochenen Arbeitszeit gemeldet werden." },
            { term: "Kreuzen", definition: "Beim Kreuzen wartet ein Zug auf einer Zugmeldestelle, weil der Zugfolgeabschnitt, in den er eingelassen werden soll, noch durch einen in der Gegenrichtung fahrenden Zug beansprucht wird." },
            { term: "Mitarbeiter", definition: "Mitarbeiter, im Sinne des bahnbetrieblichen Regelwerks, sind Personen, die Tätigkeiten im Bahnbetrieb selbstständig nur verrichten dürfen, wenn sie für diese Tätigkeiten geprüft und mit ihrer Ausführung beauftragt sind." },
            { term: "Nachgeschobene Züge", definition: "Nachgeschobene Züge sind Züge, in denen mindestens ein arbeitendes Triebfahrzeug an der Spitze läuft oder von der Spitze aus gesteuert wird und in denen bis zu zwei arbeitende Triebfahrzeuge laufen, die nicht von der Spitze aus gesteuert werden." },
            { term: "Nebenfahrzeuge", definition: "Nebenfahrzeuge werden unterschieden in Nebenfahrzeuge mit Kraftantrieb und in Nebenfahrzeuge ohne Kraftantrieb. Bestimmungen für Triebfahrzeuge gelten auch für Nebenfahrzeuge mit Kraftantrieb, sofern es nicht im Einzelfall anders bestimmt ist." },
            { term: "Nebengleise", definition: "Nebengleise sind Gleise, die planmäßig nicht von Zügen befahren werden." },
            { term: "NL (Non Leading)", definition: "Betriebsart bei ETCS, die der Triebfahrzeugführer der Zuglokomotive bei Vorspann bzw. eines mit dem Zug gekuppelten Schiebetriebfahrzeuges wählen muss." },
            { term: "Notbremsüberbrückungsabschnitt", definition: "Ein Notbremsüberbrückungsabschnitt ist ein durch NBÜ-Kennzeichen gekennzeichneter Abschnitt, in dem Züge bei einer Notbremsung nicht anhalten sollen." },
            { term: "NP (No Power)", definition: "Betriebsart bei ETCS, in die das ETCS-Fahrzeuggerät wechselt, wenn die Stromversorgung ausgeschaltet ist." },
            { term: "Ortsstellbereich", definition: "Ein Ortsstellbereich ist ein Bereich in Nebengleisen mit ortsgestellten Weichen und Gleissperren, in dem ausschließlich rangiert wird. Die Weichen und Gleissperren werden einzeln ggf. in Gruppen (elektrischer Antrieb) umgestellt. Die Bedienung erfolgt durch das Rangierpersonal. Zug- und Rangierstraßen sind nicht vorhanden. Ein für eine Rangierfahrt Halt gebietendes Signal begrenzt Ortsstellbereiche nach außen. Der Beginn eines Ortsstellbereiches kann durch ein Orientierungszeichen nach Richtlinie 301.9001 gekennzeichnet sein." },
            { term: "OS (On Sight)", definition: "Betriebsart bei ETCS, bei der ein Zug auf Sicht fahren muss, und zwar mit einer ETCS-Fahrterlaubnis, die dem Triebfahrzeugführer mit einem Symbol in der Führerraumanzeige angezeigt wird. ETCS überwacht die maximal zulässige Geschwindigkeit für Fahren auf Sicht und das Ende der ETCS-Fahrterlaubnis." },
            { term: "Override EOA", definition: "Funktion im ETCS-Fahrzeuggerät, die es dem Triebfahrzeugführer ermöglicht, aus den ETCS-Betriebsarten FS oder OS in die ETCS-Betriebsart SR zu wechseln sowie an einem ETCS-Halt vorbeizufahren." },
            { term: "Planmäßige Halte", definition: "Ein planmäßiger Halt kann:\n- als Fahrplanhalt im Fahrplan bzw. in einer Fahrplananordnung angeordnet sein oder\n- als zusätzlicher Halt angeordnet werden. Diese Anordnung darf das Eisenbahnverkehrsunternehmen erteilen." },
            { term: "PT (Post Trip)", definition: "Betriebsart bei ETCS, in die ein Zug wechselt, wenn er an einem ETCS-Halt vorbeifährt." },
            { term: "Rangieren", definition: "Rangieren ist das Bewegen von Fahrzeugen im Bahnbetrieb, ausgenommen das Fahren der Züge. Fahrten im Bahnhof, die nicht als Zugfahrt durchgeführt werden, sind Rangierfahrten." },
            { term: "Regelfahrzeuge", definition: "Regelfahrzeuge sind Schienenfahrzeuge, die den Bau- und Unterhaltungsvorschriften für Regelfahrzeuge entsprechen." },
            { term: "Regelhalt", definition: "Ein Regelhalt ist ein Fahrplanhalt, bei dem ein Zug auf der Betriebsstelle halten muss. Ein Regelhalt darf in einen Betriebshalt umgewandelt werden, wenn der Halt ausfallen darf." },
            { term: "RL (Reisezuglokomotive)", definition: "RL ist eine Betriebsart bei ETCS für eine Reisezuglokomotive, die ETCS-Funktionen bietet und nicht mit einem Zug gekuppelt ist oder am Schluss eines Zuges läuft." },
            { term: "Rückdrücken", definition: "Rückdrücken ist das Bewegen von Fahrzeugen zum Zwecke des Aufdrückens, Abstoßens oder Ablaufenlassens." },
            { term: "RZ (Reisezug)", definition: "RZ ist eine Betriebsart bei ETCS für ein Triebfahrzeug mit ETCS-Funktionen im Stand. Das Triebfahrzeug ist am Schluss eines Reisezuges oder mit einem solchen gekuppelt." },
            { term: "SB (Stand By)", definition: "Betriebsart bei ETCS, wenn das ETCS-Fahrzeuggerät eingeschaltet ist und ein Zug mit eingeschaltetem ETCS-Fahrzeuggerät abgestellt ist." },
            { term: "SB (Shunting)", definition: "Betriebsart bei ETCS, wenn Rangierfahrten durchgeführt werden." },
            { term: "S-Bahn", definition: "Eine S-Bahn ist ein Zug, der im Fahrplan für Zugmeldestellen und Streckenfahrplan durch den Zusatz „S“ hinter der Zugnummer gekennzeichnet ist." },
            { term: "Signalgeführt", definition: "Ein Zug ist signalgeführt, wenn seine Fahrt durch Hauptsignale und ihre Vorsignale zugelassen wird. Ein Zug kann auch signalgeführt sein, wenn für ihn im Führerraum die zugelassene Höchstgeschwindigkeit, eine Zielgeschwindigkeit und eine Zielentfernung überwacht wird (z. B. LZB-Führung in ETCS-Betriebsart NTC)." },
            { term: "Sperrfahrten", definition: "Sperrfahrten sind Züge, die auf Strecken oder Gleisen mit Sperrung verkehren." },
            { term: "Sperrung", definition: "Eine Sperrung ist eine auf Zeit und Raum begrenzte Anordnung, die es Zügen, Kleinwagenfahrten oder Rangierfahrten nicht erlaubt, einen Gleisabschnitt zu befahren." },
            { term: "Stichstrecke", definition: "Stichstrecken sind eingleisige Strecken, auf denen keine Züge kreuzen." },
            { term: "Strecken", definition: "Strecken sind Bahnanlagen für Fahrten zwischen Bahnhöfen und den Bahnhöfen selbst." },
            { term: "Stumpfgleis", definition: "Ein Stumpfgleis ist ein Gleis, das mit einem Prellbock, einem Erdhaufen oder einem anderen festen Signal endet." },
            { term: "Überschreiten der planmäßigen Haltezeit", definition: "Ein Zug hat die planmäßige Haltezeit überschritten, wenn er nach Ablauf der betrieblichen Abfahrzeit die Betriebsstelle noch nicht verlassen hat." },
            { term: "Überholungen", definition: "Beim Überholen fährt ein Zug an einem in derselben Richtung wartenden Zug vorbei." },
            { term: "Überleitstellen", definition: "Überleitstellen sind Bahnanlagen der freien Strecke, wo Züge von einem Gleis auf ein anderes Gleis derselben Strecke übergehen können." },
            { term: "Untersuchungsfahrt", definition: "Untersuchungsfahrten sind Züge zur Untersuchung von Fahrzeugen oder zur Durchführung von Messungen an der Infrastruktur." },
            { term: "Weichenwärter", definition: "Weichenwärter stellen die Weichen, Sperren und Signale und sichern die Zugfahrten und das Rangieren. Weichenwärter können auch Fahrdienstleiter sein, die nur für einen Teilbereich des Bahnhofs zuständig sind." },
            { term: "Züge", definition: "Züge sind einzeln fahrende Triebfahrzeuge oder Triebfahrzeuge mit angehängten Fahrzeugen, die auf die freie Strecke übergehen oder auf der freien Strecke verkehren. Ausgenommen sind Kleinwagenfahrten." },
            { term: "Zugfahrten", definition: "Zugfahrten sind Fahrten von Zügen auf der freien Strecke oder innerhalb eines Bahnhofs, die nicht als Rangierfahrten durchgeführt werden." },
            { term: "Zugmeldestellen", definition: "Zugmeldestellen sind Betriebsstellen, die der Regelung der Zugfolge dienen. Eine Zugmeldestelle kann als Bahnhof, Abzweigstelle oder Überleitstelle eingerichtet sein. Blockstellen, die nicht in einen Bahnhof, eine Abzweigstelle oder eine Überleitstelle integriert sind, gelten als Zugmeldestelle." },
            { term: "Zwangspunkte", definition: "Zwangspunkte sind Stellen, an denen die Geschwindigkeit eines Zuges durch die Zugbeeinflussung überwacht wird." }
        ];

        // Daten und Status
        let allTerms = definitions;
        let currentSessionTerms = [];
        let currentCardIndex = 0;
        let score = 0;
        let currentMode = 'learn';
        let isSessionActive = false;
        let knownTerms = new Set();
        let unknownTerms = new Set();
        const MAX_SELECTION_COUNT = 15;

        // DOM-Elemente
        const settingsView = document.getElementById('settings-view');
        const mainView = document.getElementById('main-view');
        const searchInput = document.getElementById('search-input');
        const termSelectionDiv = document.getElementById('term-selection');
        const selectAllBtn = document.getElementById('select-all');
        const deselectAllBtn = document.getElementById('deselect-all');
        const startBtn = document.getElementById('start-btn');
        const noSelectionWarning = document.getElementById('no-selection-warning');
        const selectionCountEl = document.getElementById('selection-count');
        const selectVisibleBtn = document.getElementById('select-visible');
        const clearSearchBtn = document.getElementById('clear-search');
        
        // Progress Dashboard Elements
        const totalTermsEl = document.getElementById('total-terms');
        const knownCountEl = document.getElementById('known-count');
        const unknownCountEl = document.getElementById('unknown-count');
        const neutralCountEl = document.getElementById('neutral-count');
        const progressBarEl = document.getElementById('progress-bar');
        const progressTextEl = document.getElementById('progress-text');
        const filterAllBtn = document.getElementById('filter-all');
        const filterUnknownBtn = document.getElementById('filter-unknown');
        const filterKnownBtn = document.getElementById('filter-known');
        const filterNeutralBtn = document.getElementById('filter-neutral');
        const resetProgressBtn = document.getElementById('reset-progress');

        // Initialisierungsfunktionen
        document.addEventListener('DOMContentLoaded', () => {
            initializeProgress();
            renderTermSelection(allTerms);
            updateSelectionCount();
        });
        
        // Ladebildschirm-Logik
        window.addEventListener('load', () => {
            const loader = document.getElementById('loader');
            const mainContent = document.querySelector('.main-content');
            
            setTimeout(() => {
                loader.classList.add('fade-out');
                mainContent.classList.add('visible');
                
                loader.addEventListener('transitionend', () => {
                    loader.classList.add('hidden');
                }, { once: true });
            }, 1000); // Ladezeit: 1 Sekunde
        });
        
        // Fortschritts-Funktionen
        function initializeProgress() {
            totalTermsEl.textContent = allTerms.length;
            const savedKnown = JSON.parse(localStorage.getItem('knownTerms')) || [];
            const savedUnknown = JSON.parse(localStorage.getItem('unknownTerms')) || [];
            knownTerms = new Set(savedKnown);
            unknownTerms = new Set(savedUnknown);
            updateProgressDashboard();
        }

        function updateProgressDashboard() {
            const total = allTerms.length;
            const known = knownTerms.size;
            const unknown = unknownTerms.size;
            const neutral = total - known - unknown;
            const assessed = known + unknown;
            const percentage = total > 0 ? Math.round((assessed / total) * 100) : 0;
            
            knownCountEl.textContent = known;
            unknownCountEl.textContent = unknown;
            neutralCountEl.textContent = neutral;
            progressBarEl.style.width = `${percentage}%`;
            progressTextEl.textContent = `${assessed} von ${total} Begriffen bewertet (${percentage}%)`;
            
            localStorage.setItem('knownTerms', JSON.stringify(Array.from(knownTerms)));
            localStorage.setItem('unknownTerms', JSON.stringify(Array.from(unknownTerms)));
        }

        function markTerm(term, isKnown) {
            if (isKnown) {
                knownTerms.add(term);
                unknownTerms.delete(term);
            } else {
                unknownTerms.add(term);
                knownTerms.delete(term);
            }
            updateProgressDashboard();
        }

        // Filter-Funktionen
        filterAllBtn.addEventListener('click', () => {
            renderTermSelection(allTerms);
        });
        filterUnknownBtn.addEventListener('click', () => {
            const filteredTerms = allTerms.filter(t => unknownTerms.has(t.term));
            renderTermSelection(filteredTerms);
        });
        filterKnownBtn.addEventListener('click', () => {
            const filteredTerms = allTerms.filter(t => knownTerms.has(t.term));
            renderTermSelection(filteredTerms);
        });
        filterNeutralBtn.addEventListener('click', () => {
            const filteredTerms = allTerms.filter(t => !knownTerms.has(t.term) && !unknownTerms.has(t.term));
            renderTermSelection(filteredTerms);
        });
        resetProgressBtn.addEventListener('click', () => {
            if (confirm("Möchten Sie den Lernfortschritt wirklich zurücksetzen?")) {
                localStorage.clear();
                knownTerms.clear();
                unknownTerms.clear();
                initializeProgress();
                renderTermSelection(allTerms);
            }
        });

        // Begriffe zur Auswahl rendern
        function renderTermSelection(termsToRender) {
            termSelectionDiv.innerHTML = '';
            termsToRender.forEach(termObj => {
                const isChecked = currentSessionTerms.some(t => t.term === termObj.term);
                const isKnown = knownTerms.has(termObj.term);
                const isUnknown = unknownTerms.has(termObj.term);
                
                let checkboxClass = 'accent-gray-400';
                if (isKnown) {
                    checkboxClass = 'accent-green-500';
                } else if (isUnknown) {
                    checkboxClass = 'accent-red-500';
                }
                
                const termItem = document.createElement('div');
                termItem.className = `p-2 rounded-lg cursor-pointer transition-colors duration-200 border-2 border-transparent term-selection-item ${isChecked ? 'bg-[--eb-light-teal] border-[--eb-teal]' : 'hover:bg-gray-100'}`;
                termItem.innerHTML = `
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" data-term="${termObj.term}" class="${checkboxClass}" ${isChecked ? 'checked' : ''}>
                        <span class="text-sm font-medium text-gray-700 select-none">${termObj.term}</span>
                    </label>
                `;
                
                termItem.querySelector('input').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        if (currentSessionTerms.length >= MAX_SELECTION_COUNT) {
                            alert(`Sie können maximal ${MAX_SELECTION_COUNT} Begriffe gleichzeitig auswählen.`);
                            e.target.checked = false;
                            return;
                        }
                        currentSessionTerms.push(termObj);
                        termItem.classList.add('bg-[--eb-light-teal]', 'border-[--eb-teal]');
                    } else {
                        currentSessionTerms = currentSessionTerms.filter(t => t.term !== termObj.term);
                        termItem.classList.remove('bg-[--eb-light-teal]', 'border-[--eb-teal]');
                    }
                    updateSelectionCount();
                });
                
                termSelectionDiv.appendChild(termItem);
            });
            updateSelectionCount();
        }

        // Suchfunktion
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.toLowerCase();
            const filteredTerms = allTerms.filter(termObj => 
                termObj.term.toLowerCase().includes(query) || 
                termObj.definition.toLowerCase().includes(query)
            );
            
            renderTermSelection(filteredTerms);
            
            const resultsCountEl = document.getElementById('search-results-count');
            resultsCountEl.textContent = `(${filteredTerms.length} Ergebnisse)`;
            resultsCountEl.classList.remove('hidden');
            
            if (query.length > 0) {
                selectVisibleBtn.classList.remove('hidden');
                clearSearchBtn.classList.remove('hidden');
            } else {
                selectVisibleBtn.classList.add('hidden');
                clearSearchBtn.classList.add('hidden');
            }
        });
        
        clearSearchBtn.addEventListener('click', () => {
            searchInput.value = '';
            renderTermSelection(allTerms);
            document.getElementById('search-results-count').classList.add('hidden');
            selectVisibleBtn.classList.add('hidden');
            clearSearchBtn.classList.add('hidden');
        });

        // Auswahl-Funktionen
        selectAllBtn.addEventListener('click', () => {
            currentSessionTerms = allTerms.slice(0, MAX_SELECTION_COUNT);
            renderTermSelection(allTerms);
        });
        deselectAllBtn.addEventListener('click', () => {
            currentSessionTerms = [];
            renderTermSelection(allTerms);
        });
        selectVisibleBtn.addEventListener('click', () => {
            const visibleTerms = Array.from(termSelectionDiv.querySelectorAll('input[type="checkbox"]')).map(el => el.dataset.term);
            currentSessionTerms = allTerms.filter(t => visibleTerms.includes(t.term)).slice(0, MAX_SELECTION_COUNT);
            renderTermSelection(allTerms);
        });
        function updateSelectionCount() {
            selectionCountEl.textContent = `${currentSessionTerms.length} von ${MAX_SELECTION_COUNT} Begriffen ausgewählt`;
        }

        // Start-Button
        startBtn.addEventListener('click', () => {
            if (currentSessionTerms.length === 0) {
                noSelectionWarning.classList.remove('hidden');
            } else {
                noSelectionWarning.classList.add('hidden');
                isSessionActive = true;
                settingsView.classList.add('hidden');
                mainView.classList.remove('hidden');
                initializeSession();
            }
        });

        // Sitzungs-Logik
        function initializeSession() {
            currentCardIndex = 0;
            const mode = document.querySelector('input[name="mode"]:checked').value;
            if (mode === 'learn') {
                currentSessionTerms.sort(() => Math.random() - 0.5); // Shuffle for learning
                renderLearnCard();
            } else if (mode === 'test-term') {
                currentSessionTerms.sort(() => Math.random() - 0.5); // Shuffle for testing
                renderTestTermCard();
            } else if (mode === 'test-def') {
                currentSessionTerms.sort(() => Math.random() - 0.5); // Shuffle for testing
                renderTestDefCard();
            }
        }

        function showEndScreen() {
            isSessionActive = false;
            let message = '';
            const mode = document.querySelector('input[name="mode"]:checked').value;
            if (mode.startsWith('test')) {
                const percentage = currentSessionTerms.length > 0 ? Math.round((score / currentSessionTerms.length) * 100) : 0;
                message = `
                    <h2 class="text-3xl font-bold mb-4 text-[--eb-dark-blue]">Test beendet!</h2>
                    <p class="text-xl">Du hast ${score} von ${currentSessionTerms.length} Begriffen richtig beantwortet.</p>
                    <p class="text-5xl font-bold mt-4 text-[--eb-teal]">${percentage}%</p>
                `;
            } else {
                message = `<h2 class="text-3xl font-bold mb-4 text-[--eb-dark-blue]">Lernsitzung beendet!</h2><p class="text-xl">Du hast alle ausgewählten Karteikarten durchgesehen.</p>`;
            }

            mainView.innerHTML = `
                <div class="text-center bg-white p-10 rounded-xl shadow-lg border border-gray-200">
                    ${message}
                    <div class="mt-8">
                        <button id="restart-btn" class="bg-[--eb-teal] hover:bg-[#358f8f] text-white font-bold py-3 px-6 rounded-lg transition">Neue Sitzung starten</button>
                    </div>
                </div>
            `;
            document.getElementById('restart-btn').addEventListener('click', () => {
                isSessionActive = false;
                settingsView.classList.remove('hidden');
                mainView.classList.add('hidden');
                currentSessionTerms = [];
                updateSelectionCount();
                renderTermSelection(allTerms);
            });
        }
        
        function renderCardNavigation() {
            return `
                <div class="mt-6 flex justify-between gap-4 w-full">
                    <button id="back-to-settings-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition">Zurück zu den Einstellungen</button>
                    <button id="next-card-btn" class="bg-[--eb-dark-blue] hover:bg-[#202c5c] text-white font-bold py-3 px-6 rounded-lg transition">Nächster Begriff</button>
                </div>
            `;
        }

        // Lernmodus (Karteikarten)
        function renderLearnCard() {
            if (currentCardIndex >= currentSessionTerms.length) {
                showEndScreen();
                return;
            }

            const term = currentSessionTerms[currentCardIndex];
            mainView.innerHTML = `
                <div class="card-container w-full max-w-2xl h-[400px]">
                    <div id="flashcard" class="card h-full">
                        <div class="card-face card-face-front flex-col p-8">
                            <h2 class="text-3xl font-bold text-center mb-4 text-[--eb-dark-blue]">${term.term}</h2>
                            <button id="flip-btn" class="bg-[--eb-teal] hover:bg-[#358f8f] text-white font-bold py-3 px-6 rounded-lg transition">Definition anzeigen</button>
                        </div>
                        <div class="card-face card-face-back flex-col p-8">
                            <h3 class="text-xl font-bold mb-4">Definition</h3>
                            <p class="text-gray-700 mb-4">${term.definition}</p>
                            <div class="flex gap-4">
                                <button id="known-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition">Gewusst</button>
                                <button id="unknown-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition">Nicht gewusst</button>
                            </div>
                            ${renderCardNavigation()}
                        </div>
                    </div>
                </div>
            `;
            const card = document.getElementById('flashcard');
            const flipBtn = document.getElementById('flip-btn');
            flipBtn.addEventListener('click', () => {
                card.classList.add('is-flipped');
            });

            document.getElementById('known-btn').addEventListener('click', () => {
                markTerm(term.term, true);
                currentCardIndex++;
                renderLearnCard();
            });
            document.getElementById('unknown-btn').addEventListener('click', () => {
                markTerm(term.term, false);
                currentCardIndex++;
                renderLearnCard();
            });
            
            setupNavigationListeners();
        }

        // Testmodus: Begriff -> Definition
        function renderTestTermCard() {
            if (currentCardIndex >= currentSessionTerms.length) {
                showEndScreen();
                return;
            }
            const term = currentSessionTerms[currentCardIndex];
            mainView.innerHTML = `
                <div class="definition-quiz bg-white p-8 rounded-xl shadow-lg border border-gray-200 w-full max-w-2xl">
                    <h2 class="text-2xl font-bold mb-4 text-[--eb-dark-blue] text-center">${term.term}</h2>
                    <p class="text-center text-gray-500 mb-6">${term.hint || "Schreibe die Definition auf..."}</p>
                    <textarea id="user-answer" class="w-full p-4 border rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-[--eb-teal]" rows="6" placeholder="Deine Antwort..."></textarea>
                    <div id="feedback" class="mt-4 p-4 rounded-lg hidden"></div>
                    <div class="mt-6 flex justify-between gap-4">
                        <button id="check-btn" class="flex-1 bg-[--eb-teal] hover:bg-[#358f8f] text-white font-bold py-3 px-6 rounded-lg transition">Prüfen</button>
                        <button id="next-btn" class="flex-1 bg-[--eb-dark-blue] hover:bg-[#202c5c] text-white font-bold py-3 px-6 rounded-lg transition hidden">Nächster Begriff</button>
                    </div>
                    <button id="show-answer-btn" class="mt-4 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition">Antwort anzeigen</button>
                </div>
            `;
            
            document.getElementById('check-btn').addEventListener('click', () => checkAnswer(term, 'term'));
            document.getElementById('next-btn').addEventListener('click', () => {
                currentCardIndex++;
                renderTestTermCard();
            });
            document.getElementById('show-answer-btn').addEventListener('click', () => showCorrectAnswer(term, 'term'));
        }

        // Testmodus: Definition -> Begriff
        function renderTestDefCard() {
            if (currentCardIndex >= currentSessionTerms.length) {
                showEndScreen();
                return;
            }
            const term = currentSessionTerms[currentCardIndex];
            
            const allTermsArray = allTerms.map(t => t.term);
            const correctTerm = term.term;
            
            const wrongOptions = new Set();
            while (wrongOptions.size < 3) {
                const randomTerm = allTermsArray[Math.floor(Math.random() * allTermsArray.length)];
                if (randomTerm !== correctTerm) {
                    wrongOptions.add(randomTerm);
                }
            }
            
            const options = [...wrongOptions, correctTerm].sort(() => Math.random() - 0.5);

            mainView.innerHTML = `
                <div class="definition-quiz bg-white p-8 rounded-xl shadow-lg border border-gray-200 w-full max-w-2xl">
                    <h2 class="text-2xl font-bold mb-4 text-[--eb-dark-blue] text-center">Welcher Begriff passt zu dieser Definition?</h2>
                    <p class="text-gray-700 mb-6">${term.definition}</p>
                    <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${options.map(opt => `<button class="answer-option bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg transition duration-200 text-left">${opt}</button>`).join('')}
                    </div>
                    <div id="feedback" class="mt-4 p-4 rounded-lg hidden"></div>
                    <button id="next-btn" class="mt-6 w-full bg-[--eb-dark-blue] hover:bg-[#202c5c] text-white font-bold py-3 px-6 rounded-lg transition hidden">Nächster Begriff</button>
                </div>
            `;
            
            document.querySelectorAll('.answer-option').forEach(button => {
                button.addEventListener('click', (e) => checkMultipleChoice(e.target.textContent, correctTerm));
            });
            document.getElementById('next-btn').addEventListener('click', () => {
                currentCardIndex++;
                renderTestDefCard();
            });
        }
        
        function checkAnswer(term, type) {
            const userAnswer = document.getElementById('user-answer').value.trim();
            const correctAnswer = type === 'term' ? term.definition : term.term;
            const feedbackEl = document.getElementById('feedback');
            const checkBtn = document.getElementById('check-btn');
            const nextBtn = document.getElementById('next-btn');

            const diff = JsDiff.diffWords(correctAnswer, userAnswer);
            
            feedbackEl.innerHTML = '';
            diff.forEach((part) => {
                const span = document.createElement('span');
                span.textContent = part.value;
                if (part.added) {
                    span.style.backgroundColor = 'lightgreen';
                }
                if (part.removed) {
                    span.style.backgroundColor = 'salmon';
                }
                feedbackEl.appendChild(span);
            });
            feedbackEl.classList.remove('hidden');

            const isCorrect = (userAnswer.toLowerCase().replace(/\s/g, '') === correctAnswer.toLowerCase().replace(/\s/g, ''));
            if (isCorrect) {
                score++;
                markTerm(term.term, true);
                feedbackEl.innerHTML = '<span class="text-green-700 font-bold">Richtig!</span>';
            } else {
                markTerm(term.term, false);
                feedbackEl.innerHTML += '<div class="mt-2 text-red-700 font-bold">Leider falsch. Die richtige Antwort ist:</div>'
            }

            checkBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
        }

        function showCorrectAnswer(term, type) {
            const feedbackEl = document.getElementById('feedback');
            const checkBtn = document.getElementById('check-btn');
            const nextBtn = document.getElementById('next-btn');
            const showAnswerBtn = document.getElementById('show-answer-btn');
            
            const correctAnswer = type === 'term' ? term.definition : term.term;
            
            feedbackEl.innerHTML = `<div class="font-bold">Richtige Antwort:</div><p>${correctAnswer}</p>`;
            feedbackEl.classList.remove('hidden');
            
            checkBtn.classList.add('hidden');
            showAnswerBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
            
            markTerm(term.term, false); // Markiert als "Nicht gewusst"
        }

        function checkMultipleChoice(selectedAnswer, correctAnswer) {
            const feedbackEl = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');
            const buttons = document.querySelectorAll('.answer-option');
            
            buttons.forEach(button => {
                button.disabled = true;
                if (button.textContent === correctAnswer) {
                    button.classList.add('bg-green-500', 'text-white');
                } else if (button.textContent === selectedAnswer) {
                    button.classList.add('bg-red-500', 'text-white');
                }
            });

            if (selectedAnswer === correctAnswer) {
                score++;
                markTerm(correctAnswer, true);
                feedbackEl.innerHTML = '<p class="text-green-700 font-bold">Richtig!</p>';
            } else {
                markTerm(correctAnswer, false);
                feedbackEl.innerHTML = `<p class="text-red-700 font-bold">Leider falsch. Die richtige Antwort war "${correctAnswer}".</p>`;
            }
            
            feedbackEl.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
        }

        function setupNavigationListeners() {
            document.getElementById('back-to-settings-btn').addEventListener('click', () => {
                isSessionActive = false;
                settingsView.classList.remove('hidden');
                mainView.classList.add('hidden');
                currentSessionTerms = [];
                updateSelectionCount();
                renderTermSelection(allTerms);
            });
            document.getElementById('next-card-btn').addEventListener('click', () => {
                currentCardIndex++;
                renderLearnCard();
            });
        }
    </script>
</body>
</html>
